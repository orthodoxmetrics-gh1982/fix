#!/bin/bash

# üó∫Ô∏è Install ParishMap Component via Big Book Auto-Install
# ========================================================
# This script helps install ParishMap.tsx using the Big Book Auto-Install TSX Component system

echo "üó∫Ô∏è Installing ParishMap Component via Big Book Auto-Install"
echo "=========================================================="
echo "[$(date '+%Y-%m-%d %H:%M:%S')] Starting ParishMap component installation..."

# Check if ParishMap.tsx exists
if [ ! -f "ParishMap.tsx" ]; then
    echo "‚ùå ERROR: ParishMap.tsx not found in current directory"
    echo "üí° Please run this script from the directory containing ParishMap.tsx"
    echo "   Expected location: /a%3A/prod/"
    exit 1
fi

echo "‚úÖ Found ParishMap.tsx in current directory"
echo ""

# Display component information
echo "üìã Component Information:"
echo "------------------------"
echo "‚Ä¢ File: ParishMap.tsx"
echo "‚Ä¢ Size: $(wc -c < ParishMap.tsx) bytes"
echo "‚Ä¢ Lines: $(wc -l < ParishMap.tsx) lines"
echo "‚Ä¢ Type: React TypeScript Component"
echo ""

echo "üéØ Big Book Auto-Install Features:"
echo "‚Ä¢ Automatic installation to /src/components/bigbook/custom/"
echo "‚Ä¢ Kebab-case route generation: /bigbook/parish-map"
echo "‚Ä¢ Automatic menu integration in Big Book sidebar"
echo "‚Ä¢ Component registry management"
echo "‚Ä¢ Security validation and parsing"
echo ""

echo "üìã Installation Instructions:"
echo "=============================="
echo ""
echo "To install ParishMap.tsx using Big Book Auto-Install:"
echo ""
echo "1. üåê Open your browser and navigate to the Big Book interface"
echo "   URL: https://orthodoxmetrics.com/admin (or your admin interface)"
echo ""
echo "2. üîì Ensure you're logged in as super_admin or editor"
echo ""
echo "3. üìÅ Navigate to the 'Big Book' section in the admin panel"
echo ""
echo "4. üß© Go to the 'Custom Components' tab"
echo ""
echo "5. üì§ Use one of these methods to upload ParishMap.tsx:"
echo ""
echo "   METHOD A - Drag & Drop:"
echo "   ‚Ä¢ Drag the ParishMap.tsx file from your file manager"
echo "   ‚Ä¢ Drop it onto the Big Book upload area"
echo "   ‚Ä¢ The TSX Component Installation Wizard will open automatically"
echo ""
echo "   METHOD B - File Upload:"
echo "   ‚Ä¢ Click the upload area in Big Book"
echo "   ‚Ä¢ Select ParishMap.tsx from the file picker"
echo "   ‚Ä¢ The TSX Component Installation Wizard will open automatically"
echo ""
echo "6. üöÄ In the TSX Component Installation Wizard:"
echo "   ‚Ä¢ Enable 'Big Book Auto-Install Mode' toggle"
echo "   ‚Ä¢ This will automatically:"
echo "     - Set target directory to: src/components/bigbook/custom"
echo "     - Enable registry integration"
echo "     - Generate route: /bigbook/parish-map"
echo "     - Add menu item to Big Book sidebar"
echo ""
echo "7. ‚úÖ Click 'Install Component' to complete the installation"
echo ""
echo "8. üîÑ The system will:"
echo "   ‚Ä¢ Validate the component syntax and structure"
echo "   ‚Ä¢ Install it to the correct directory"
echo "   ‚Ä¢ Update the component registry"
echo "   ‚Ä¢ Add a menu item to the Big Book sidebar"
echo "   ‚Ä¢ Generate the route for accessing the component"
echo ""
echo "9. üéâ Once installed, you can:"
echo "   ‚Ä¢ View the component at: /bigbook/parish-map"
echo "   ‚Ä¢ Access it from the Big Book sidebar menu"
echo "   ‚Ä¢ Manage it from the 'Custom Components' tab"
echo ""

echo "üîß Expected Results After Installation:"
echo "======================================="
echo ""
echo "‚úÖ Component will be installed at:"
echo "   front-end/src/components/bigbook/custom/ParishMap.tsx"
echo ""
echo "‚úÖ Route will be available at:"
echo "   https://orthodoxmetrics.com/bigbook/parish-map"
echo ""
echo "‚úÖ Menu item will appear in Big Book sidebar:"
echo "   üìÑ Parish Map"
echo ""
echo "‚úÖ Component registry entry will be created in:"
echo "   front-end/src/config/bigbook-custom-components.json"
echo ""

echo "üö® Prerequisites:"
echo "=================="
echo "‚Ä¢ Server must be running on port 3001"
echo "‚Ä¢ Backend Big Book Auto-Install API endpoints must be loaded"
echo "‚Ä¢ User must have super_admin or editor permissions"
echo "‚Ä¢ Frontend must be built with the latest changes"
echo ""

echo "üí° Troubleshooting:"
echo "==================="
echo ""
echo "If 'Install Component' button is greyed out:"
echo "‚Ä¢ Check browser console for errors"
echo "‚Ä¢ Ensure you're logged in with proper permissions"
echo "‚Ä¢ Verify server is running and accessible"
echo ""
echo "If installation fails:"
echo "‚Ä¢ Check the Big Book console output for error details"
echo "‚Ä¢ Verify the component has valid React TypeScript syntax"
echo "‚Ä¢ Ensure all dependencies are available"
echo ""
echo "For component viewing issues:"
echo "‚Ä¢ The component viewer is currently temporarily disabled for debugging"
echo "‚Ä¢ Components can still be installed and accessed via direct routes"
echo "‚Ä¢ Use the route: /bigbook/parish-map to access after installation"
echo ""

echo "üìù Component Dependencies:"
echo "=========================="
echo "The ParishMap component requires these dependencies:"
echo "‚Ä¢ react-leaflet (for map functionality)"
echo "‚Ä¢ leaflet (base mapping library)"
echo "‚Ä¢ react-leaflet-markercluster (for marker clustering)"
echo "‚Ä¢ @headlessui/react (for UI components)"
echo "‚Ä¢ @heroicons/react (for icons)"
echo ""
echo "‚ö†Ô∏è  Note: The auto-install system will attempt to install missing dependencies"
echo "   automatically. If installation fails due to missing deps, you may need"
echo "   to install them manually in the frontend."
echo ""

echo "[$(date '+%Y-%m-%d %H:%M:%S')] Script completed"
echo ""
echo "üéØ Next Step: Open your browser and follow the installation instructions above!" 