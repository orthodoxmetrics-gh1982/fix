<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OrthodoxMetrics - Parish Income Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 10px 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 25px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 25px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #2196F3;
        }
        
        input:checked + .slider:before {
            transform: translateX(25px);
        }
        
        .chart-container {
            position: relative;
            height: 600px;
            padding: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #2196F3;
            margin: 0;
        }
        
        .stat-card .change {
            font-size: 0.8em;
            margin-top: 5px;
            padding: 3px 8px;
            border-radius: 12px;
            display: inline-block;
        }
        
        .positive { background: #d4edda; color: #155724; }
        .negative { background: #f8d7da; color: #721c24; }
        
        .insights {
            padding: 20px;
            background: #fff;
        }
        
        .insights h2 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .insight-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #2196F3;
            border-radius: 5px;
        }
        
        .event-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: #e9ecef;
            border-radius: 15px;
            font-size: 0.8em;
        }
        
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä OrthodoxMetrics Dashboard</h1>
        <p>Parish Income & Membership Analysis ‚Ä¢ 2004-2024 ‚Ä¢ 21 Years of Data</p>
    </div>

    <div class="dashboard-container">
        <div class="controls">
            <div class="control-group">
                <label>Total Income</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="totalIncomeToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="control-group">
                <label>Sunday Envelope</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="envelopeToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="control-group">
                <label>Membership (Census)</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="censusToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="control-group">
                <label>Per Capita Giving</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="perCapitaToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="control-group">
                <label>Event Annotations</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="annotationsToggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="mainChart"></canvas>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>2024 Total Income</h3>
                <p class="value">$171,223</p>
                <span class="change negative">-3.4% from 2023</span>
            </div>
            <div class="stat-card">
                <h3>Current Membership</h3>
                <p class="value">60</p>
                <span class="change negative">-46% since 2004</span>
            </div>
            <div class="stat-card">
                <h3>Per Capita Giving 2024</h3>
                <p class="value">$2,854</p>
                <span class="change positive">+176% since 2004</span>
            </div>
            <div class="stat-card">
                <h3>20-Year Average Income</h3>
                <p class="value">$156,427</p>
                <span class="change">Stable despite membership decline</span>
            </div>
        </div>

        <div class="insights">
            <h2>üîç Key Insights</h2>
            <div class="insight-item">
                <strong>Exceptional Generosity:</strong> Despite losing 46% of membership since 2004, the parish maintains strong financial health through dramatically increased per capita giving (up 176%).
            </div>
            <div class="insight-item">
                <strong>Estate Gift Impact:</strong> Major income spikes in 2005 (+26%), 2011 (+37%), and 2022 (+15%) likely represent estate gifts or capital campaigns providing crucial financial stability.
            </div>
            <div class="insight-item">
                <strong>Crisis Resilience:</strong> The parish weathered the 2008 financial crisis and COVID-19 pandemic with minimal long-term impact, showing strong commitment from core membership.
            </div>
            <div class="insight-item">
                <strong>Sustainability Challenge:</strong> While current financial health is strong, continued membership decline poses long-term sustainability concerns requiring strategic planning.
            </div>

            <div class="event-legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ff6b6b;"></div>
                    Economic Crisis
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #4ecdc4;"></div>
                    Estate Gift/Campaign
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #45b7d1;"></div>
                    COVID-19 Impact
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #f9ca24;"></div>
                    Membership Change
                </div>
            </div>
        </div>
    </div>

    <script>
        // Church income data
        const churchData = [
            {year: 2004, sunday_envelope: 87228, total_income: 114591, census: 111, giving_per_capita: 1032.35, event_note: "Above-average generosity relative to national median income"},
            {year: 2005, sunday_envelope: 87142, total_income: 144603, census: 100, giving_per_capita: 1446.03, event_note: "Significant income increase (+26.2%); Possible estate gift"},
            {year: 2006, sunday_envelope: 104401, total_income: 146649, census: 100, giving_per_capita: 1466.49, event_note: "Above-average generosity"},
            {year: 2007, sunday_envelope: 120473, total_income: 123088, census: 90, giving_per_capita: 1367.64, event_note: "Notable income decline (-16.1%); Membership decline"},
            {year: 2008, sunday_envelope: 102568, total_income: 133819, census: 90, giving_per_capita: 1486.88, event_note: "Global financial crisis impact"},
            {year: 2009, sunday_envelope: 99325, total_income: 128493, census: 90, giving_per_capita: 1427.70, event_note: "Continued recession impact"},
            {year: 2010, sunday_envelope: 92506, total_income: 138856, census: 90, giving_per_capita: 1542.84, event_note: "Recovery beginning"},
            {year: 2011, sunday_envelope: 89076, total_income: 190838, census: 89, giving_per_capita: 2144.25, event_note: "Significant income increase (+37.4%); Likely major estate gift"},
            {year: 2012, sunday_envelope: 111287, total_income: 168215, census: 77, giving_per_capita: 2184.61, event_note: "Major envelope giving increase (+24.9%); Notable membership decline"},
            {year: 2013, sunday_envelope: 111399, total_income: 165299, census: 77, giving_per_capita: 2146.74, event_note: "Stabilizing after volatility"},
            {year: 2014, sunday_envelope: 105617, total_income: 177657, census: 76, giving_per_capita: 2337.59, event_note: "Possible estate gift"},
            {year: 2015, sunday_envelope: 118466, total_income: 148870, census: 77, giving_per_capita: 1933.38, event_note: "Notable income decline (-16.2%); End of estate gift period"},
            {year: 2016, sunday_envelope: 111925, total_income: 159253, census: 77, giving_per_capita: 2068.22, event_note: "Recovery from 2015 decline"},
            {year: 2017, sunday_envelope: 112639, total_income: 157670, census: 79, giving_per_capita: 1995.82, event_note: "Membership growth; Stable giving"},
            {year: 2018, sunday_envelope: 122430, total_income: 163196, census: 80, giving_per_capita: 2039.95, event_note: "Continued growth"},
            {year: 2019, sunday_envelope: 117963, total_income: 163196, census: 80, giving_per_capita: 2039.95, event_note: "Stable period"},
            {year: 2020, sunday_envelope: 126516, total_income: 155516, census: 80, giving_per_capita: 1943.95, event_note: "COVID-19 pandemic begins"},
            {year: 2021, sunday_envelope: 132704, total_income: 165374, census: 78, giving_per_capita: 2120.18, event_note: "COVID-19 recovery year"},
            {year: 2022, sunday_envelope: 152899, total_income: 189553, census: null, giving_per_capita: null, event_note: "Strong post-pandemic recovery; Possible special campaign"},
            {year: 2023, sunday_envelope: 134446, total_income: 177210, census: 60, giving_per_capita: 2953.5, event_note: "Membership decline evident; Very high per capita giving"},
            {year: 2024, sunday_envelope: 129862, total_income: 171223, census: 60, giving_per_capita: 2853.72, event_note: "Continued high generosity despite smaller membership"}
        ];

        const ctx = document.getElementById('mainChart').getContext('2d');
        
        // Create the chart
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: churchData.map(d => d.year),
                datasets: [
                    {
                        label: 'Total Income ($)',
                        data: churchData.map(d => d.total_income),
                        borderColor: '#2196F3',
                        backgroundColor: 'rgba(33, 150, 243, 0.1)',
                        yAxisID: 'y',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.2
                    },
                    {
                        label: 'Sunday Envelope ($)',
                        data: churchData.map(d => d.sunday_envelope),
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        yAxisID: 'y',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.2
                    },
                    {
                        label: 'Membership Count',
                        data: churchData.map(d => d.census),
                        borderColor: '#FF9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.1)',
                        yAxisID: 'y1',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.2,
                        pointStyle: 'rect',
                        pointRadius: 5
                    },
                    {
                        label: 'Per Capita Giving ($)',
                        data: churchData.map(d => d.giving_per_capita),
                        borderColor: '#9C27B0',
                        backgroundColor: 'rgba(156, 39, 176, 0.1)',
                        yAxisID: 'y2',
                        borderWidth: 2,
                        fill: false,
                        tension: 0.2,
                        borderDash: [5, 5]
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Parish Financial Trends (2004-2024)',
                        font: {
                            size: 18,
                            weight: 'bold'
                        },
                        padding: 20
                    },
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    },
                    tooltip: {
                        callbacks: {
                            title: function(tooltipItems) {
                                return 'Year: ' + tooltipItems[0].label;
                            },
                            afterBody: function(tooltipItems) {
                                const yearData = churchData.find(d => d.year == tooltipItems[0].label);
                                return yearData.event_note ? '\nüìù ' + yearData.event_note : '';
                            }
                        },
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: 'white',
                        bodyColor: 'white',
                        borderColor: '#2196F3',
                        borderWidth: 1,
                        displayColors: true,
                        padding: 12
                    }
                },
                scales: {
                    x: {
                        display: true,
                        title: {
                            display: true,
                            text: 'Year',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)'
                        }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Income ($)',
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: '#2196F3'
                        },
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            },
                            color: '#2196F3'
                        },
                        grid: {
                            color: 'rgba(33, 150, 243, 0.1)'
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Membership Count',
                            font: {
                                size: 14,
                                weight: 'bold'
                            },
                            color: '#FF9800'
                        },
                        ticks: {
                            color: '#FF9800'
                        },
                        grid: {
                            drawOnChartArea: false,
                        },
                        min: 50,
                        max: 120
                    },
                    y2: {
                        type: 'linear',
                        display: false,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Per Capita ($)',
                            color: '#9C27B0'
                        },
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            },
                            color: '#9C27B0'
                        },
                        grid: {
                            drawOnChartArea: false,
                        }
                    }
                },
                elements: {
                    point: {
                        radius: 4,
                        hoverRadius: 8
                    }
                }
            }
        });

        // Toggle controls
        function toggleDataset(toggleId, datasetIndex) {
            document.getElementById(toggleId).addEventListener('change', function() {
                const dataset = chart.data.datasets[datasetIndex];
                dataset.hidden = !this.checked;
                chart.update();
            });
        }

        toggleDataset('totalIncomeToggle', 0);
        toggleDataset('envelopeToggle', 1);
        toggleDataset('censusToggle', 2);
        toggleDataset('perCapitaToggle', 3);

        // Annotations toggle (simplified - just shows/hides tooltip info)
        document.getElementById('annotationsToggle').addEventListener('change', function() {
            chart.options.plugins.tooltip.enabled = this.checked;
            chart.update();
        });

        // Add special event markers
        function addEventMarkers() {
            const eventYears = [
                {year: 2005, color: '#4ecdc4', label: 'Estate Gift'},
                {year: 2008, color: '#ff6b6b', label: 'Financial Crisis'},
                {year: 2011, color: '#4ecdc4', label: 'Major Estate Gift'},
                {year: 2020, color: '#45b7d1', label: 'COVID-19'},
                {year: 2022, color: '#4ecdc4', label: 'Post-COVID Recovery'}
            ];

            // This would be enhanced with Chart.js annotation plugin in a real implementation
        }

        // Initialize
        addEventMarkers();
    </script>
</body>
</html>