#!/bin/bash

echo "üîê Frontend Authentication Checker"
echo "=================================="
echo "This script helps check if you're properly logged in to the frontend."
echo ""

# Function to log with timestamp
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1"
}

log "Checking frontend authentication status..."

echo ""
log "=== AUTHENTICATION VERIFICATION ==="
echo ""
echo "To verify you're logged in with proper permissions:"
echo ""
echo "1. üåê OPEN YOUR FRONTEND:"
echo "   ‚Ä¢ http://localhost:3000 (development)"
echo "   ‚Ä¢ https://orthodoxmetrics.com (production)"
echo ""
echo "2. üîç CHECK YOUR LOGIN STATUS:"
echo "   ‚Ä¢ Look for your username in the top-right corner"
echo "   ‚Ä¢ Make sure you're logged in (not seeing a login form)"
echo ""
echo "3. üë§ VERIFY YOUR USER ROLE:"
echo "   ‚Ä¢ Go to Admin Settings (or Admin Dashboard)"
echo "   ‚Ä¢ If you can see admin options, you have the right permissions"
echo "   ‚Ä¢ Required roles: super_admin OR editor"
echo ""
echo "4. üß™ TEST WITH BIG BOOK:"
echo "   ‚Ä¢ Go to Admin Settings ‚Üí OM Big Book"
echo "   ‚Ä¢ Try uploading any .tsx file"
echo "   ‚Ä¢ Check the console messages in the wizard"
echo ""

echo ""
log "=== CONSOLE MESSAGE DIAGNOSTICS ==="
echo ""
echo "When you upload a TSX file, look for these messages:"
echo ""
echo "‚úÖ GOOD MESSAGES (means you're authenticated):"
echo "   'üîç Parsing .tsx file: [filename]'"
echo "   '‚úÖ Component parsed successfully: [ComponentName]'"
echo ""
echo "‚ùå BAD MESSAGES (means authentication issues):"
echo "   'üîê Authentication required: Please log in as super_admin or editor'"
echo "   '‚ùå Server error: HTTP 401 - Unauthorized'"
echo "   '‚ùå Server error: HTTP 403 - Forbidden'"
echo ""

echo ""
log "=== TROUBLESHOOTING STEPS ==="
echo ""
echo "If you're getting authentication errors:"
echo ""
echo "1. üîÑ REFRESH THE PAGE:"
echo "   ‚Ä¢ Sometimes sessions expire"
echo "   ‚Ä¢ Hard refresh: Ctrl+F5 or Cmd+Shift+R"
echo ""
echo "2. üîë RE-LOGIN:"
echo "   ‚Ä¢ Log out completely"
echo "   ‚Ä¢ Log back in with a super_admin or editor account"
echo ""
echo "3. üç™ CHECK COOKIES/SESSION:"
echo "   ‚Ä¢ Open browser dev tools (F12)"
echo "   ‚Ä¢ Check Application/Storage ‚Üí Cookies"
echo "   ‚Ä¢ Look for session cookies for your domain"
echo ""
echo "4. üß™ TEST BASIC API ACCESS:"
echo "   ‚Ä¢ While logged in, open browser console (F12)"
echo "   ‚Ä¢ Run: fetch('/api/status', {credentials: 'include'}).then(r => r.json()).then(console.log)"
echo "   ‚Ä¢ Should return server status, not authentication error"
echo ""

echo ""
log "=== FRONTEND BUILD CHECK ==="
echo ""
echo "If you made changes and they're not working:"
echo ""
echo "1. üèóÔ∏è REBUILD THE FRONTEND:"
echo "   ‚Ä¢ cd front-end"
echo "   ‚Ä¢ npm run build (with --legacy-peer-deps if needed)"
echo "   ‚Ä¢ Wait for build to complete"
echo ""
echo "2. üîÑ REFRESH BROWSER:"
echo "   ‚Ä¢ Hard refresh the page"
echo "   ‚Ä¢ Clear browser cache if needed"
echo ""

echo ""
log "=== NEXT STEPS ==="
echo ""
echo "After verifying authentication:"
echo "1. ‚úÖ You should be logged in as super_admin/editor"
echo "2. ‚úÖ Try uploading a TSX file in Big Book"
echo "3. ‚úÖ Look for the improved error messages"
echo "4. ‚úÖ Install button should enable after successful parsing"

echo ""
log "=== CHECK COMPLETE ==="
echo ""
echo "If you're still having issues after following these steps,"
echo "please share the console messages from the TSX upload wizard." 