{
  "id": "bbec250d9ee3",
  "originalPath": "/var/www/orthodox-church-mgmt/orthodoxmetrics/prod/scripts/7-26-25/reset-mariadb-root-password.sh",
  "relativePath": "scripts/7-26-25/reset-mariadb-root-password.sh",
  "name": "reset-mariadb-root-password.sh",
  "extension": ".sh",
  "size": 4256,
  "modified": "2025-07-24T23:11:17.697Z",
  "created": "2025-07-24T23:11:13.557Z",
  "classification": {
    "type": "Database Scripts",
    "category": "Backend > Database",
    "confidence": 3
  },
  "metadata": {
    "fileStats": {
      "lines": 180,
      "characters": 4242,
      "words": 607
    },
    "classification": {
      "type": "Database Scripts",
      "category": "Backend > Database",
      "confidence": 3
    },
    "dependencies": [],
    "security": {
      "findings": [
        {
          "type": "sensitive_data",
          "pattern": "(?:password|pwd|pass)\\s*[:=]\\s*['\"]([^'\"]+)['\"]",
          "line": 36,
          "redacted": true
        }
      ],
      "hasSecurityIssues": true,
      "redactedContent": "#!/bin/bash\n\n# Reset MariaDB Root Password Script\n# Use this when socket access is disabled and you can't login\n\necho \"🔑 MariaDB Root Password Reset\"\necho \"==============================\"\n\n# Colors\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\nprint_ok() { echo -e \"${GREEN}✅ $1${NC}\"; }\nprint_warn() { echo -e \"${YELLOW}⚠️  $1${NC}\"; }\nprint_error() { echo -e \"${RED}❌ $1${NC}\"; }\nprint_info() { echo -e \"${BLUE}ℹ️  $1${NC}\"; }\n\necho \"\"\n\n# Check if running as root\nif [[ $EUID -ne 0 ]]; then\n    print_error \"This script must be run as root (use sudo)\"\n    exit 1\nfi\n\nprint_warn \"IMPORTANT: This will reset your MariaDB root password!\"\nprint_info \"Make sure to save the new password securely.\"\necho \"\"\n\n# Prompt for new password\nread -s -p \"Enter new password for root@localhost: \" NEW_PASSWORD\necho \"\"\nread -s -p \"Confirm new password: \"[REDACTED]\"\"\n\nif [ \"$NEW_PASSWORD\" != \"$CONFIRM_PASSWORD\" ]; then\n    print_error \"Passwords do not match!\"\n    exit 1\nfi\n\nif [ -z \"$NEW_PASSWORD\" ]; then\n    print_error \"Password cannot be empty!\"\n    exit 1\nfi\n\necho \"\"\n\n# Step 1: Stop MariaDB service\nprint_info \"1. Stopping MariaDB service...\"\nif systemctl stop mariadb; then\n    print_ok \"MariaDB service stopped\"\nelse\n    print_warn \"Service stop failed, attempting to kill processes...\"\n    pkill -f mysqld\n    sleep 2\nfi\n\necho \"\"\n\n# Step 2: Start MariaDB in safe mode\nprint_info \"2. Starting MariaDB in safe mode (skip-grant-tables)...\"\nprint_warn \"This temporarily disables authentication for security purposes.\"\n\n# Create a temporary configuration file\nTEMP_CNF=$(mktemp)\ncat > \"$TEMP_CNF\" << EOF\n[mysqld]\nskip-grant-tables\nskip-networking\nuser=mysql\ndatadir=/var/lib/mysql\nsocket=/var/run/mysqld/mysqld.sock\nEOF\n\n# Start MariaDB with skip-grant-tables\nprint_info \"Starting MariaDB with skip-grant-tables...\"\nmysqld --defaults-file=\"$TEMP_CNF\" --user=mysql &\nMYSQLD_PID=$!\n\n# Wait for MariaDB to start\nprint_info \"Waiting for MariaDB to start...\"\nsleep 10\n\n# Check if MariaDB is running\nif ! ps -p $MYSQLD_PID > /dev/null; then\n    print_error \"MariaDB failed to start in safe mode\"\n    rm -f \"$TEMP_CNF\"\n    exit 1\nfi\n\nprint_ok \"MariaDB started in safe mode\"\n\necho \"\"\n\n# Step 3: Reset the root password\nprint_info \"3. Resetting root password...\"\n\n# Create SQL commands\nTEMP_SQL=$(mktemp)\ncat > \"$TEMP_SQL\" << EOF\nUSE mysql;\n\n-- For MariaDB 10.4+\nALTER USER 'root'@'localhost' IDENTIFIED BY '$NEW_PASSWORD';\n\n-- Flush privileges to apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the change\nSELECT user, host, plugin FROM user WHERE user='root' AND host='localhost';\nEOF\n\n# Execute the SQL commands\nif mysql < \"$TEMP_SQL\"; then\n    print_ok \"Root password updated successfully\"\nelse\n    print_error \"Failed to update root password\"\n    rm -f \"$TEMP_CNF\" \"$TEMP_SQL\"\n    kill $MYSQLD_PID 2>/dev/null\n    exit 1\nfi\n\necho \"\"\n\n# Step 4: Stop MariaDB safe mode\nprint_info \"4. Stopping MariaDB safe mode...\"\nkill $MYSQLD_PID\nsleep 5\n\n# Make sure it's stopped\npkill -f mysqld\nsleep 2\n\nprint_ok \"MariaDB safe mode stopped\"\n\necho \"\"\n\n# Step 5: Start MariaDB normally\nprint_info \"5. Starting MariaDB service normally...\"\nif systemctl start mariadb; then\n    print_ok \"MariaDB service started successfully\"\nelse\n    print_error \"Failed to start MariaDB service\"\n    rm -f \"$TEMP_CNF\" \"$TEMP_SQL\"\n    exit 1\nfi\n\necho \"\"\n\n# Step 6: Test the new password\nprint_info \"6. Testing new root password...\"\nsleep 3\n\nif mysql -u root -p\"$NEW_PASSWORD\" -e \"SELECT 'Password reset successful!' as status;\" 2>/dev/null; then\n    print_ok \"Password reset successful! You can now login with:\"\n    echo \"\"\n    echo \"  mysql -u root -p\"\n    echo \"\"\n    print_info \"Enter the password when prompted: $NEW_PASSWORD\"\nelse\n    print_error \"Password test failed. You may need to try again.\"\n    rm -f \"$TEMP_CNF\" \"$TEMP_SQL\"\n    exit 1\nfi\n\necho \"\"\n\n# Cleanup\nrm -f \"$TEMP_CNF\" \"$TEMP_SQL\"\n\nprint_ok \"MariaDB root password reset complete!\"\nprint_info \"Remember to save your new password securely.\"\necho \"\"\nprint_info \"Next steps:\"\necho \"  1. Test your applications with the new password\"\necho \"  2. Update any configuration files that use the old password\"\necho \"  3. Consider creating application-specific users for security\" "
    },
    "complexity": {
      "totalLines": 180,
      "codeLines": 122,
      "commentLines": 20,
      "commentRatio": 0.14084507042253522,
      "averageLineLength": 28.612676056338028
    },
    "lastAnalyzed": "2025-07-28T07:19:59.014Z"
  },
  "contentHash": "5136a65f8c33f55c05cde1c108eb3e27c705f2388acc4c5a39d40013766a959d",
  "discoveredAt": "2025-07-28T07:19:59.014Z"
}