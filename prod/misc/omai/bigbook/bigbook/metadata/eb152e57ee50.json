{
  "id": "eb152e57ee50",
  "originalPath": "/var/www/orthodox-church-mgmt/orthodoxmetrics/prod/server/debug/check-frontend-auth.js",
  "relativePath": "server/debug/check-frontend-auth.js",
  "name": "check-frontend-auth.js",
  "extension": ".js",
  "size": 3512,
  "modified": "2025-07-22T03:58:17.742Z",
  "created": "2025-07-22T03:58:17.742Z",
  "classification": {
    "type": "Troubleshooting Utilities",
    "category": "Diagnostic Tools",
    "confidence": 3
  },
  "metadata": {
    "fileStats": {
      "lines": 71,
      "characters": 3476,
      "words": 328
    },
    "classification": {
      "type": "Troubleshooting Utilities",
      "category": "Diagnostic Tools",
      "confidence": 3
    },
    "dependencies": [],
    "security": {
      "findings": [
        {
          "type": "sensitive_data",
          "pattern": "(?:secret|token)\\s*[:=]\\s*['\"]([^'\"]+)['\"]",
          "line": 17,
          "redacted": true
        }
      ],
      "hasSecurityIssues": true,
      "redactedContent": "#!/usr/bin/env node\r\n\r\nconsole.log('üîç Frontend Authentication Debug Script');\r\nconsole.log('=====================================\\n');\r\n\r\nconsole.log('This script helps debug why Content and Services tabs are greyed out.\\n');\r\n\r\nconsole.log('üìã MANUAL DEBUG STEPS:');\r\nconsole.log('1. Open browser developer tools (F12)');\r\nconsole.log('2. Go to your OrthodoxMetrics site');\r\nconsole.log('3. Open Console tab');\r\nconsole.log('4. Paste this code to check auth state:\\n');\r\n\r\nconsole.log('// Check authentication state');\r\nconsole.log('console.log(\"=== AUTH DEBUG ===\");');\r\nconsole.log('console.log(\"Current user:\", localStorage.getItem(\"user\"));');\r\nconsole.log('console.log(\"Auth token:\"[REDACTED]\"authToken\"));');\r\nconsole.log('console.log(\"Session storage:\", sessionStorage.getItem(\"user\"));');\r\nconsole.log('');\r\nconsole.log('// Check if React context has user data');\r\nconsole.log('// (Run this in React DevTools or add to component)');\r\nconsole.log('// const { user, isSuperAdmin, hasRole } = useAuth();');\r\nconsole.log('// console.log(\"User from context:\", user);');\r\nconsole.log('// console.log(\"isSuperAdmin():\", isSuperAdmin());');\r\nconsole.log('// console.log(\"hasRole([\\'admin\\', \\'super_admin\\']):\", hasRole([\"admin\", \"super_admin\"]));');\r\nconsole.log('');\r\n\r\nconsole.log('üîß COMMON ISSUES & FIXES:');\r\nconsole.log('');\r\nconsole.log('‚ùå ISSUE: User object is null/undefined');\r\nconsole.log('   ‚úÖ FIX: Clear cookies, localStorage, sessionStorage and login again');\r\nconsole.log('');\r\nconsole.log('‚ùå ISSUE: User role is not \"admin\" or \"super_admin\"');\r\nconsole.log('   ‚úÖ FIX: Update user role in database:');\r\nconsole.log('   UPDATE orthodoxmetrics_db.users SET role = \"super_admin\" WHERE email = \"your@email.com\";');\r\nconsole.log('');\r\nconsole.log('‚ùå ISSUE: Session expired');\r\nconsole.log('   ‚úÖ FIX: Check session with: node debug/check-active-sessions.js');\r\nconsole.log('');\r\nconsole.log('‚ùå ISSUE: hasRole function not working');\r\nconsole.log('   ‚úÖ FIX: Check AuthContext implementation');\r\nconsole.log('');\r\n\r\nconsole.log('üîç BACKEND VERIFICATION:');\r\nconsole.log('Run these commands on your Linux server:');\r\nconsole.log('');\r\nconsole.log('# Check current sessions');\r\nconsole.log('node debug/check-active-sessions.js');\r\nconsole.log('');\r\nconsole.log('# Check user role in database');\r\nconsole.log('mysql -u root -p -e \"SELECT id, email, role FROM orthodoxmetrics_db.users WHERE email = \\'superadmin@orthodoxmetrics.com\\';\"');\r\nconsole.log('');\r\nconsole.log('# Check if backend auth middleware is working');\r\nconsole.log('curl -H \"Cookie: orthodox.sid=YOUR_SESSION_ID\" https://orthodoxmetrics.com/api/admin/system-info');\r\nconsole.log('');\r\n\r\nconsole.log('üéØ EXPECTED BEHAVIOR:');\r\nconsole.log('- User should have role \"admin\" or \"super_admin\"');\r\nconsole.log('- hasRole([\"admin\", \"super_admin\"]) should return true');\r\nconsole.log('- isSuperAdmin() OR hasRole() should make tabs visible');\r\nconsole.log('- Content and Services tabs should appear and be clickable');\r\nconsole.log('');\r\n\r\nconsole.log('üìß If still greyed out, the issue is likely:');\r\nconsole.log('1. Session not persisting (cookie domain mismatch)');\r\nconsole.log('2. User role incorrect in database');  \r\nconsole.log('3. Frontend auth context not updating properly');\r\nconsole.log('4. Authentication middleware rejecting requests');\r\n\r\nconsole.log('\\n‚úÖ Run this to get your session ID:');\r\nconsole.log('Open browser DevTools ‚Üí Application ‚Üí Cookies ‚Üí look for \"orthodox.sid\"'); "
    },
    "complexity": {
      "totalLines": 71,
      "codeLines": 61,
      "commentLines": 1,
      "commentRatio": 0.016129032258064516,
      "averageLineLength": 54.79032258064516
    },
    "lastAnalyzed": "2025-07-28T07:20:00.072Z"
  },
  "contentHash": "abd4a79adbcd3d83b4eed13761cf79e6851c5214f1bdc8a5549b65d1212797fa",
  "discoveredAt": "2025-07-28T07:20:00.072Z"
}