{
  "id": "3381550a8c1d",
  "originalPath": "/var/www/orthodox-church-mgmt/orthodoxmetrics/prod/reset-password-skip-grant-tables.sh",
  "relativePath": "reset-password-skip-grant-tables.sh",
  "name": "reset-password-skip-grant-tables.sh",
  "extension": ".sh",
  "size": 5581,
  "modified": "2025-07-24T23:12:45.611Z",
  "created": "2025-07-24T23:12:41.577Z",
  "classification": {
    "type": "Database Scripts",
    "category": "Backend > Database",
    "confidence": 1
  },
  "metadata": {
    "fileStats": {
      "lines": 204,
      "characters": 5567,
      "words": 771
    },
    "classification": {
      "type": "Database Scripts",
      "category": "Backend > Database",
      "confidence": 1
    },
    "dependencies": [],
    "security": {
      "findings": [
        {
          "type": "sensitive_data",
          "pattern": "(?:password|pwd|pass)\\s*[:=]\\s*['\"]([^'\"]+)['\"]",
          "line": 59,
          "redacted": true
        }
      ],
      "hasSecurityIssues": true,
      "redactedContent": "#!/bin/bash\n\n# Reset MariaDB Root Password - Skip Grant Tables Mode\n# Use this when MariaDB is already running with --skip-grant-tables\n\necho \"🔑 MariaDB Root Password Reset (Skip Grant Tables Mode)\"\necho \"======================================================\"\n\n# Colors\nRED='\\033[0;31m'\nGREEN='\\033[0;32m'\nYELLOW='\\033[1;33m'\nBLUE='\\033[0;34m'\nNC='\\033[0m'\n\nprint_ok() { echo -e \"${GREEN}✅ $1${NC}\"; }\nprint_warn() { echo -e \"${YELLOW}⚠️  $1${NC}\"; }\nprint_error() { echo -e \"${RED}❌ $1${NC}\"; }\nprint_info() { echo -e \"${BLUE}ℹ️  $1${NC}\"; }\n\necho \"\"\n\n# Check if running as root\nif [[ $EUID -ne 0 ]]; then\n    print_error \"This script must be run as root (use sudo)\"\n    exit 1\nfi\n\n# Check if MariaDB is running with skip-grant-tables\nprint_info \"1. Checking MariaDB status...\"\nMYSQLD_PROCESSES=$(ps aux | grep mysqld | grep -v grep | grep -v \"reset-password\\|troubleshoot\")\n\nif [ -z \"$MYSQLD_PROCESSES\" ]; then\n    print_error \"No mysqld processes found. MariaDB may not be running.\"\n    exit 1\nfi\n\nprint_ok \"Found mysqld processes:\"\necho \"$MYSQLD_PROCESSES\"\necho \"\"\n\n# Check if skip-grant-tables is active\nif echo \"$MYSQLD_PROCESSES\" | grep -q \"skip-grant-tables\"; then\n    print_ok \"MariaDB is running with skip-grant-tables\"\nelse\n    print_warn \"MariaDB is running but may not be in skip-grant-tables mode\"\n    print_info \"Attempting to connect anyway...\"\nfi\n\necho \"\"\n\n# Prompt for new password\nprint_warn \"IMPORTANT: This will reset your MariaDB root password!\"\nprint_info \"Make sure to save the new password securely.\"\necho \"\"\n\nread -s -p \"Enter new password for root@localhost: \" NEW_PASSWORD\necho \"\"\nread -s -p \"Confirm new password: \"[REDACTED]\"\"\n\nif [ \"$NEW_PASSWORD\" != \"$CONFIRM_PASSWORD\" ]; then\n    print_error \"Passwords do not match!\"\n    exit 1\nfi\n\nif [ -z \"$NEW_PASSWORD\" ]; then\n    print_error \"Password cannot be empty!\"\n    exit 1\nfi\n\necho \"\"\n\n# Step 2: Reset the root password\nprint_info \"2. Resetting root password...\"\n\n# Create SQL commands\nTEMP_SQL=$(mktemp)\ncat > \"$TEMP_SQL\" << EOF\nUSE mysql;\n\n-- For MariaDB 10.4+\nALTER USER 'root'@'localhost' IDENTIFIED BY '$NEW_PASSWORD';\n\n-- Flush privileges to apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the change\nSELECT user, host, plugin FROM user WHERE user='root' AND host='localhost';\nEOF\n\n# Execute the SQL commands\nprint_info \"Executing password reset commands...\"\nif mysql < \"$TEMP_SQL\"; then\n    print_ok \"Root password updated successfully\"\nelse\n    print_error \"Failed to update root password\"\n    print_info \"Trying alternative method...\"\n    \n    # Try alternative method for older MariaDB versions\n    cat > \"$TEMP_SQL\" << EOF\nUSE mysql;\n\n-- Alternative method for older versions\nUPDATE user SET authentication_string = PASSWORD('$NEW_PASSWORD') WHERE user='root' AND host='localhost';\n\n-- Flush privileges\nFLUSH PRIVILEGES;\n\n-- Verify the change\nSELECT user, host, plugin FROM user WHERE user='root' AND host='localhost';\nEOF\n\n    if mysql < \"$TEMP_SQL\"; then\n        print_ok \"Root password updated successfully (alternative method)\"\n    else\n        print_error \"Both methods failed to update password\"\n        rm -f \"$TEMP_SQL\"\n        exit 1\n    fi\nfi\n\necho \"\"\n\n# Step 3: Stop MariaDB skip-grant-tables mode\nprint_info \"3. Stopping MariaDB skip-grant-tables mode...\"\n\n# Find and kill the mysqld process\nMYSQLD_PIDS=$(ps aux | grep mysqld | grep -v grep | grep -v \"reset-password\\|troubleshoot\" | awk '{print $2}')\n\nif [ -n \"$MYSQLD_PIDS\" ]; then\n    print_info \"Stopping mysqld processes: $MYSQLD_PIDS\"\n    for pid in $MYSQLD_PIDS; do\n        if kill $pid 2>/dev/null; then\n            print_ok \"Sent SIGTERM to PID $pid\"\n        else\n            print_warn \"Failed to send SIGTERM to PID $pid, trying force kill...\"\n            kill -9 $pid 2>/dev/null\n        fi\n    done\n    \n    # Wait for processes to stop\n    sleep 5\n    \n    # Make sure all processes are stopped\n    pkill -f mysqld\n    sleep 2\n    \n    print_ok \"MariaDB skip-grant-tables mode stopped\"\nelse\n    print_warn \"No mysqld processes found to stop\"\nfi\n\necho \"\"\n\n# Step 4: Start MariaDB normally\nprint_info \"4. Starting MariaDB service normally...\"\nif systemctl start mariadb; then\n    print_ok \"MariaDB service started successfully\"\nelse\n    print_error \"Failed to start MariaDB service\"\n    print_info \"Checking service status...\"\n    systemctl status mariadb --no-pager\n    rm -f \"$TEMP_SQL\"\n    exit 1\nfi\n\necho \"\"\n\n# Step 5: Test the new password\nprint_info \"5. Testing new root password...\"\nsleep 3\n\nif mysql -u root -p\"$NEW_PASSWORD\" -e \"SELECT 'Password reset successful!' as status;\" 2>/dev/null; then\n    print_ok \"Password reset successful! You can now login with:\"\n    echo \"\"\n    echo \"  mysql -u root -p\"\n    echo \"\"\n    print_info \"Enter the password when prompted: $NEW_PASSWORD\"\nelse\n    print_error \"Password test failed. You may need to try again.\"\n    print_info \"Checking if MariaDB is running...\"\n    systemctl status mariadb --no-pager\n    rm -f \"$TEMP_SQL\"\n    exit 1\nfi\n\necho \"\"\n\n# Cleanup\nrm -f \"$TEMP_SQL\"\n\nprint_ok \"MariaDB root password reset complete!\"\nprint_info \"Remember to save your new password securely.\"\necho \"\"\nprint_info \"Next steps:\"\necho \"  1. Test your applications with the new password\"\necho \"  2. Update any configuration files that use the old password\"\necho \"  3. Consider creating application-specific users for security\"\necho \"\"\nprint_info \"Useful commands:\"\necho \"  sudo systemctl status mariadb    # Check service status\"\necho \"  mysql -u root -p                 # Connect to database\"\necho \"  sudo systemctl restart mariadb   # Restart service\" "
    },
    "complexity": {
      "totalLines": 204,
      "codeLines": 143,
      "commentLines": 19,
      "commentRatio": 0.11728395061728394,
      "averageLineLength": 33.01234567901235
    },
    "lastAnalyzed": "2025-07-26T04:17:10.289Z"
  },
  "contentHash": "2e2c64d997563404e6104834a2cfb732a7b6fbec8b6c5eb96c3b4934a995b96c",
  "discoveredAt": "2025-07-26T04:17:10.289Z"
}