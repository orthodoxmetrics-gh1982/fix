
📋 Processing 39 tables that need church_id...


🔧 Processing table: activity_feed
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing activity_feed: Can't create table `orthodoxmetrics_db`.`activity_feed` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: admin_settings
   - Backfill via: created_by
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing admin_settings: Can't create table `orthodoxmetrics_db`.`admin_settings` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: audit_logs
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing audit_logs: Can't create table `orthodoxmetrics_db`.`audit_logs` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: bigbook_notes
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing bigbook_notes: Can't create table `orthodoxmetrics_db`.`bigbook_notes` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: blog_categories
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing blog_categories: Can't create table `orthodoxmetrics_db`.`blog_categories` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: blog_comments
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing blog_comments: Can't create table `orthodoxmetrics_db`.`blog_comments` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: blog_posts
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing blog_posts: Can't create table `orthodoxmetrics_db`.`blog_posts` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: calendar_settings
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing calendar_settings: Can't create table `orthodoxmetrics_db`.`calendar_settings` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: chat_conversations
   - Backfill via: created_by
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing chat_conversations: Can't create table `orthodoxmetrics_db`.`chat_conversations` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: chat_participants
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing chat_participants: Can't create table `orthodoxmetrics_db`.`chat_participants` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: component_usage
   - Backfill via: user_id
   - Row count: 908
   ✓ Adding church_id column and FK...
   ❌ Error processing component_usage: Can't create table `orthodoxmetrics_db`.`component_usage` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: error_logs
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing error_logs: Can't create table `orthodoxmetrics_db`.`error_logs` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: kanban_boards
   - Backfill via: created_by
   - Row count: 1
   ✓ Adding church_id column and FK...
   ❌ Error processing kanban_boards: Can't create table `orthodoxmetrics_db`.`kanban_boards` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: kanban_board_members
   - Backfill via: user_id
   - Row count: 1
   ✓ Adding church_id column and FK...
   ❌ Error processing kanban_board_members: Can't create table `orthodoxmetrics_db`.`kanban_board_members` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: kanban_tasks
   - Backfill via: created_by
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing kanban_tasks: Can't create table `orthodoxmetrics_db`.`kanban_tasks` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: kanban_task_activity
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing kanban_task_activity: Can't create table `orthodoxmetrics_db`.`kanban_task_activity` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: kanban_task_comments
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing kanban_task_comments: Can't create table `orthodoxmetrics_db`.`kanban_task_comments` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: notes
   - Backfill via: created_by
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing notes: Can't create table `orthodoxmetrics_db`.`notes` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: notifications
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing notifications: Can't create table `orthodoxmetrics_db`.`notifications` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: notification_history
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing notification_history: Can't create table `orthodoxmetrics_db`.`notification_history` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: notification_queue
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing notification_queue: Can't create table `orthodoxmetrics_db`.`notification_queue` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: notification_subscriptions
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing notification_subscriptions: Can't create table `orthodoxmetrics_db`.`notification_subscriptions` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: omai_logs
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing omai_logs: Can't create table `orthodoxmetrics_db`.`omai_logs` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: omb_templates
   - Backfill via: created_by
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing omb_templates: Can't create table `orthodoxmetrics_db`.`omb_templates` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: password_resets
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing password_resets: Can't create table `orthodoxmetrics_db`.`password_resets` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: push_subscriptions
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing push_subscriptions: Can't create table `orthodoxmetrics_db`.`push_subscriptions` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: questionnaire_responses
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing questionnaire_responses: Can't create table `orthodoxmetrics_db`.`questionnaire_responses` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: refresh_tokens
   - Backfill via: user_id
   - Row count: 3
   ✓ Adding church_id column and FK...
   ❌ Error processing refresh_tokens: Can't create table `orthodoxmetrics_db`.`refresh_tokens` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: sessions
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing sessions: Can't create table `orthodoxmetrics_db`.`sessions` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: social_media
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing social_media: Can't create table `orthodoxmetrics_db`.`social_media` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: social_reactions
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing social_reactions: Can't create table `orthodoxmetrics_db`.`social_reactions` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: task_activity_log
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing task_activity_log: Can't create table `orthodoxmetrics_db`.`task_activity_log` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_activity_logs
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing user_activity_logs: Can't create table `orthodoxmetrics_db`.`user_activity_logs` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_component_summary
   - Backfill via: user_id
   - Row count: 61
   ✓ Adding church_id column and FK...
   ❌ Error processing user_component_summary: Can't create table `orthodoxmetrics_db`.`user_component_summary` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_notification_preferences
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing user_notification_preferences: Can't create table `orthodoxmetrics_db`.`user_notification_preferences` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_profiles
   - Backfill via: user_id
   - Row count: 1
   ✓ Adding church_id column and FK...
   ❌ Error processing user_profiles: Can't create table `orthodoxmetrics_db`.`user_profiles` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_sessions
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing user_sessions: Can't create table `orthodoxmetrics_db`.`user_sessions` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_sessions_social
   - Backfill via: user_id
   - Row count: 0
   ✓ Adding church_id column and FK...
   ❌ Error processing user_sessions_social: Can't create table `orthodoxmetrics_db`.`user_sessions_social` (errno: 150 "Foreign key constraint is incorrectly formed")

🔧 Processing table: user_social_settings
   - Backfill via: user_id
   - Row count: 1
   ✓ Adding church_id column and FK...
   ❌ Error processing user_social_settings: Can't create table `orthodoxmetrics_db`.`user_social_settings` (errno: 150 "Foreign key constraint is incorrectly formed")

📊 Checking for unassigned rows...
Error: You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'INSERT INTO tmp_unassigned SELECT 'error_logs', COUNT(*) FROM `orthodoxmetric...' at line 1
    at PromiseConnection.execute (/var/www/orthodoxmetrics/node_modules/mysql2/lib/promise/connection.js:47:22)
    at main (/var/www/orthodoxmetrics/prod/ops/scripts/apply_church_id.js:99:22)
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'ER_PARSE_ERROR',
  errno: 1064,
  sql: 'CALL omx_report_unassigned()',
  sqlState: '42000',
  sqlMessage: "You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near 'INSERT INTO tmp_unassigned SELECT 'error_logs', COUNT(*) FROM `orthodoxmetric...' at line 1"
}
